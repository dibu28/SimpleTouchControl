/*! SimpleTouchControl Phaser Plugin v0.1 | (c) 2013 dibu28. */
Phaser.Plugin.SimpleTouchControl=function(a,b){Phaser.Plugin.call(this,a,b),this.pointers=[],this.game=a,this.hideIfUp=!1,this.moveSprite1=null,this.moveSprite2=null,this.actionSprite=null,this.defaultPosition={moveControl:{x:80,y:this.game.height-80},actionControl:{x:this.game.width-60,y:this.game.height-60}},this.moveMainColor="cyan",this.moveSecondColor="cyan",this.actionColor="red",this.showMoveControl=!0,this.showActionControl=!0,this.deltaX=0,this.deltaY=0,this.action=!1,this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.safeRange=5,this.simpleCanvasControls=!1,this._drawMoveCallback=null,this._drawActionCallback=null,this._touchMoveID=-1,this._touchActionID=-1},Phaser.Plugin.SimpleTouchControl.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.SimpleTouchControl.prototype.constructor=Phaser.Plugin.SimpleTouchControl,Phaser.Plugin.SimpleTouchControl.prototype.addPointer=function(a){this.pointers.push(a)},Phaser.Plugin.SimpleTouchControl.prototype.render=function(){if(this.pointers.length>0)for(i=0;i<this.pointers.length;i++)this._renderPointer(this.pointers[i])},Phaser.Plugin.SimpleTouchControl.prototype.setDrawMoveCallback=function(a){this._drawMoveCallback=a},Phaser.Plugin.SimpleTouchControl.prototype.setDrawActionCallback=function(a){this._drawActionCallback=a},Phaser.Plugin.SimpleTouchControl.prototype._renderPointer=function(a){return a.isUp===!0?(a.id===this._touchMoveID&&(this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.deltaX=0,this.deltaY=0,this._touchMoveID=-1,this.showMoveControl&&this._drawMovementControl(a)),a.id===this._touchActionID&&(this.action=!1,this._touchActionID=-1,this.showActionControl&&this._drawActionControl(a)),void 0):(a.positionDown.x<this.game.width/2?(-1===this._touchMoveID||this._touchMoveID===a.id)&&(a.positionDown.x-a.position.x>this.safeRange?(this.left=!0,this.right=!1,this.deltaX=a.position.x-a.positionDown.x,this._touchMoveID=a.id):a.positionDown.x-a.position.x<-this.safeRange?(this.left=!1,this.right=!0,this.deltaX=a.position.x-a.positionDown.x,this._touchMoveID=a.id):(this.left=!1,this.right=!1,this.deltaX=0,this._touchMoveID=a.id),a.positionDown.y-a.position.y>this.safeRange?(this.up=!0,this.down=!1,this.deltaY=a.position.y-a.positionDown.y,this._touchMoveID=a.id):a.positionDown.y-a.position.y<-this.safeRange?(this.up=!1,this.down=!0,this.deltaY=a.position.y-a.positionDown.y,this._touchMoveID=a.id):(this.up=!1,this.down=!1,this.deltaY=0,this._touchMoveID=a.id),this.showMoveControl&&this._drawMovementControl(a)):(-1===this._touchActionID||this._touchActionID===a.id)&&(this.action=!0,this._touchActionID=a.id,this.showActionControl&&this._drawActionControl(a)),void 0)},Phaser.Plugin.SimpleTouchControl.prototype._drawMovementControl=function(a){if(null!==this._drawMoveCallback&&"function"==typeof this._drawMoveCallback)this._drawMoveCallback(a);else if(this.simpleCanvasControls){if(null==this.game.context||null==a)return;var b=this.game.context;b.save(),b.setTransform(1,0,0,1,0,0),this.currentAlpha=b.globalAlpha,b.globalAlpha=1,b.beginPath(),b.strokeStyle=this.moveMainColor,b.lineWidth=6,b.arc(a.positionDown.x,a.positionDown.y,40,0,2*Math.PI,!0),b.stroke(),b.beginPath(),b.strokeStyle=this.moveMainColor,b.lineWidth=2,b.arc(a.positionDown.x,a.positionDown.y,60,0,2*Math.PI,!0),b.stroke(),b.beginPath(),b.strokeStyle=this.moveSecondColor,b.arc(a.position.x,a.position.y,40,0,2*Math.PI,!0),b.stroke(),b.restore(),b.globalAlpha=this.currentAlpha}else a.isUp===!0?this.hideIfUp?(this.moveSprite1.visible=!1,this.moveSprite2.visible=!1):(this.moveSprite1.x=this.defaultPosition.moveControl.x,this.moveSprite1.y=this.defaultPosition.moveControl.y,this.moveSprite2.x=this.defaultPosition.moveControl.x,this.moveSprite2.y=this.defaultPosition.moveControl.y):(this.moveSprite1.visible=!0,this.moveSprite2.visible=!0,this.moveSprite1.x=a.position.x,this.moveSprite1.y=a.position.y,this.moveSprite2.x=a.positionDown.x,this.moveSprite2.y=a.positionDown.y)},Phaser.Plugin.SimpleTouchControl.prototype._drawActionControl=function(a){if(null!==this._drawActionCallback&&"function"==typeof this._drawActionCallback)this._drawActionCallback(a);else if(this.simpleCanvasControls){if(null==this.game.context||null==a)return;var b=this.game.context;b.save(),b.setTransform(1,0,0,1,0,0),this.currentAlpha=b.globalAlpha,b.globalAlpha=1,b.beginPath(),b.arc(a.position.x,a.position.y,40,0,2*Math.PI,!0),b.lineWidth="6",b.strokeStyle=this.actionColor,b.stroke(),b.restore(),b.globalAlpha=this.currentAlpha}else a.isUp===!0?this.hideIfUp?this.actionSprite.visible=!1:(this.actionSprite.x=this.defaultPosition.actionControl.x,this.actionSprite.y=this.defaultPosition.actionControl.y):(this.actionSprite.visible=!0,this.actionSprite.x=a.position.x,this.actionSprite.y=a.position.y)};